// Data object contains all categories
let data = {
  categories: {
    Movies: [
      {
        name: "The Godfather",
        selected: false,
      },
      {
        name: "Titanic",
        selected: false,
      },
      {
        name: "Whiplash",
        selected: false,
      },
      {
        name: "Coco",
        selected: false,
      },
      {
        name: "Soul",
        selected: false,
      },
      {
        name: "Inside out",
        selected: false,
      },
      {
        name: "Spirit",
        selected: false,
      },
      {
        name: "Inception",
        selected: false,
      },
      {
        name: "Gladiator",
        selected: false,
      },
      {
        name: "Migration",
        selected: false,
      },
      {
        name: "Doctor Strang",
        selected: false,
      },
      {
        name: "Casablanca",
        selected: false,
      },
      {
        name: "Psycho",
        selected: false,
      },
      {
        name: "Avatar",
        selected: false,
      },
      {
        name: "Jaws",
        selected: false,
      },
      {
        name: "Frozen",
        selected: false,
      },
      {
        name: "The Matrix",
        selected: false,
      },
      {
        name: "Goodfellas",
        selected: false,
      },
      {
        name: "Braveheart",
        selected: false,
      },
      {
        name: "Fight Club",
        selected: false,
      },
      {
        name: "Pulp Fiction",
        selected: false,
      },
      {
        name: "Forrest Gump",
        selected: false,
      },
      {
        name: "The Lion King",
        selected: false,
      },
      {
        name: "Jurassic Park",
        selected: false,
      },
      {
        name: "Blade Runner",
        selected: false,
      },
      {
        name: "Star Wars",
        selected: false,
      },
      {
        name: "The Dark Knight",
        selected: false,
      },
      {
        name: "The Big Lebowski",
        selected: false,
      },
      {
        name: "Toy Story",
        selected: false,
      },
      {
        name: "Alien",
        selected: false,
      },
      {
        name: "Interstellar",
        selected: false,
      },
      {
        name: "La La Land",
        selected: false,
      },
    ],
    "TV Shows": [
      {
        name: "Anne with an E",
        selected: false,
      },
      {
        name: "Breaking Bad",
        selected: false,
      },
      {
        name: "South Park",
        selected: false,
      },
      {
        name: "Game of Thrones",
        selected: false,
      },
      {
        name: "Stranger Things",
        selected: false,
      },
      {
        name: "The Sopranos",
        selected: false,
      },
      {
        name: "Friends",
        selected: false,
      },
      {
        name: "The Office",
        selected: false,
      },
      {
        name: "Sherlock",
        selected: false,
      },
      {
        name: "Black Mirror",
        selected: false,
      },
      {
        name: "The Crown",
        selected: false,
      },
      {
        name: "From the Earth to the Moon",
        selected: false,
      },
      {
        name: "Westworld",
        selected: false,
      },
      {
        name: "Better Call Saul",
        selected: false,
      },
      {
        name: "The Simpsons",
        selected: false,
      },
      {
        name: "Cosmos",
        selected: false,
      },
      {
        name: "Arrested Development",
        selected: false,
      },
      {
        name: "Succession",
        selected: false,
      },
      {
        name: "Fargo",
        selected: false,
      },
      {
        name: "Mad Men",
        selected: false,
      },
      {
        name: "The West Wing",
        selected: false,
      },
      {
        name: "Dexter",
        selected: false,
      },
      {
        name: "Rick and Morty",
        selected: false,
      },
      {
        name: "Lost",
        selected: false,
      },
      {
        name: "Doctor Who",
        selected: false,
      },
      {
        name: "The Walking Dead",
        selected: false,
      },
      {
        name: "Peaky Blinders",
        selected: false,
      },
      {
        name: "Curb Your Enthusiasm",
        selected: false,
      },
      {
        name: "Ted Lasso",
        selected: false,
      },
      {
        name: "True Detective",
        selected: false,
      },
    ],
    Countries: [
      {
        name: "Palestine",
        selected: false,
      },
      {
        name: "Egypt",
        selected: false,
      },
      {
        name: "Australia",
        selected: false,
      },
      {
        name: "Angola",
        selected: false,
      },
      {
        name: "Poland",
        selected: false,
      },
      {
        name: "Brazil",
        selected: false,
      },
      {
        name: "Canada",
        selected: false,
      },
      {
        name: "Cuba",
        selected: false,
      },
      {
        name: "Denmark",
        selected: false,
      },
      {
        name: "France",
        selected: false,
      },
      {
        name: "Germany",
        selected: false,
      },
      {
        name: "India",
        selected: false,
      },
      {
        name: "Japan",
        selected: false,
      },
      {
        name: "Kenya",
        selected: false,
      },
      {
        name: "Luxembourg",
        selected: false,
      },
      {
        name: "Mexico",
        selected: false,
      },
      {
        name: "Netherlands",
        selected: false,
      },
      {
        name: "Oman",
        selected: false,
      },
      {
        name: "Peru",
        selected: false,
      },
      {
        name: "Qatar",
        selected: false,
      },
      {
        name: "Russia",
        selected: false,
      },
      {
        name: "Spain",
        selected: false,
      },
      {
        name: "Thailand",
        selected: false,
      },
      {
        name: "United Kingdom",
        selected: false,
      },
      {
        name: "Vietnam",
        selected: false,
      },
      {
        name: "Italy",
        selected: false,
      },
      {
        name: "United States",
        selected: false,
      },
      {
        name: "China",
        selected: false,
      },
      {
        name: "South Africa",
        selected: false,
      },
      {
        name: "New Zealand",
        selected: false,
      },
      {
        name: "Argentina",
        selected: false,
      },
      {
        name: "Belgium",
        selected: false,
      },
      {
        name: "Chile",
        selected: false,
      },
    ],
    Jobs: [
      {
        name: "Programmer",
        selected: false,
      },
      {
        name: "Engineer",
        selected: false,
      },
      {
        name: "Lawyer",
        selected: false,
      },
      {
        name: "Doctor",
        selected: false,
      },
      {
        name: "Fire Fighter",
        selected: false,
      },
      {
        name: "Chef",
        selected: false,
      },
      {
        name: "Teacher",
        selected: false,
      },
      {
        name: "Author",
        selected: false,
      },
      {
        name: "Acountant",
        selected: false,
      },
      {
        name: "Astronaut",
        selected: false,
      },
      {
        name: "Musician",
        selected: false,
      },
      {
        name: "Soldier",
        selected: false,
      },
      {
        name: "Astronomer",
        selected: false,
      },
      {
        name: "Detective",
        selected: false,
      },
      {
        name: "Farmer",
        selected: false,
      },
      {
        name: "Judge",
        selected: false,
      },
      {
        name: "Scientist",
        selected: false,
      },
      {
        name: "Artist",
        selected: false,
      },
      {
        name: "Pilot",
        selected: false,
      },
      {
        name: "Journalist",
        selected: false,
      },
      {
        name: "Florist",
        selected: false,
      },
      {
        name: "Photographer",
        selected: false,
      },
      {
        name: "Designer",
        selected: false,
      },
      {
        name: "Data Analyst",
        selected: false,
      },
      {
        name: "Database Administrator",
        selected: false,
      },
      {
        name: "DevOps Engineer",
        selected: false,
      },
      {
        name: "IT Project Manager",
        selected: false,
      },
      {
        name: "JavaScript Developer",
        selected: false,
      },
      {
        name: "React Developer",
        selected: false,
      },
      {
        name: "Web Developer",
        selected: false,
      },
      {
        name: "Logistics Manager",
        selected: false,
      },
      {
        name: "Network Engineer",
        selected: false,
      },
      {
        name: "Professor",
        selected: false,
      },
    ],
    Animals: [
      {
        name: "Elephant",
        selected: false,
      },
      {
        name: "Lion",
        selected: false,
      },
      {
        name: "Giraffe",
        selected: false,
      },
      {
        name: "Penguin",
        selected: false,
      },
      {
        name: "Dolphin",
        selected: false,
      },
      {
        name: "Tiger",
        selected: false,
      },
      {
        name: "Kangaroo",
        selected: false,
      },
      {
        name: "Panda",
        selected: false,
      },
      {
        name: "Zebra",
        selected: false,
      },
      {
        name: "Polar Bear",
        selected: false,
      },
      {
        name: "Cheetah",
        selected: false,
      },
      {
        name: "Rhino",
        selected: false,
      },
      {
        name: "Buffalo",
        selected: false,
      },
      {
        name: "Koala",
        selected: false,
      },
      {
        name: "Gorilla",
        selected: false,
      },
      {
        name: "Chimpanzee",
        selected: false,
      },
      {
        name: "Squirrel",
        selected: false,
      },
      {
        name: "Camal",
        selected: false,
      },
      {
        name: "Alligator",
        selected: false,
      },
      {
        name: "Lynx",
        selected: false,
      },
      {
        name: "Crocodile",
        selected: false,
      },
      {
        name: "Flamingo",
        selected: false,
      },
      {
        name: "Peacock",
        selected: false,
      },
      {
        name: "Jaguar",
        selected: false,
      },
      {
        name: "Leopard",
        selected: false,
      },
      {
        name: "Wolf",
        selected: false,
      },
      {
        name: "Fox",
        selected: false,
      },
      {
        name: "Bald Eagle",
        selected: false,
      },
      {
        name: "Owl",
        selected: false,
      },
      {
        name: "Frog",
        selected: false,
      },
      {
        name: "Shark",
        selected: false,
      },
      {
        name: "Octopus",
        selected: false,
      },
      {
        name: "Turtle",
        selected: false,
      },
      {
        name: "Snake",
        selected: false,
      },
    ],
    Sports: [
      {
        name: "Soccer",
        selected: false,
      },
      {
        name: "Basketball",
        selected: false,
      },
      {
        name: "Tennis",
        selected: false,
      },
      {
        name: "Baseball",
        selected: false,
      },
      {
        name: "Rock Climbing",
        selected: false,
      },
      {
        name: "Swimming",
        selected: false,
      },
      {
        name: "Volleyball",
        selected: false,
      },
      {
        name: "Table Tennis",
        selected: false,
      },
      {
        name: "Badminton",
        selected: false,
      },
      {
        name: "Rugby",
        selected: false,
      },
      {
        name: "Cricket",
        selected: false,
      },
      {
        name: "Hockey",
        selected: false,
      },
      {
        name: "Boxing",
        selected: false,
      },
      {
        name: "Martial Arts",
        selected: false,
      },
      {
        name: "Fencing",
        selected: false,
      },
      {
        name: "Archery",
        selected: false,
      },
      {
        name: "Skiing",
        selected: false,
      },
      {
        name: "Bobsleigh",
        selected: false,
      },
      {
        name: "Cycling",
        selected: false,
      },
      {
        name: "Curling",
        selected: false,
      },
      {
        name: "Surfing",
        selected: false,
      },
      {
        name: "Diving",
        selected: false,
      },
      {
        name: "Golf",
        selected: false,
      },
      {
        name: "Football",
        selected: false,
      },
      {
        name: "Gymnastics",
        selected: false,
      },
      {
        name: "Figure Skating",
        selected: false,
      },
      {
        name: "Equestrian",
        selected: false,
      },
      {
        name: "Karate",
        selected: false,
      },
      {
        name: "Athletics",
        selected: false,
      },
      {
        name: "Rowing",
        selected: false,
      },
      {
        name: "Sailing",
        selected: false,
      },
      {
        name: "Canoeing",
        selected: false,
      },
      {
        name: "Ice Hockey",
        selected: false,
      },
      {
        name: "Triathlon",
        selected: false,
      },
      {
        name: "American Football",
        selected: false,
      },
    ],
  },
};

// All Buttons
let howToBtn = document.querySelector(".how-to-btn");
let backBtn = document.querySelector(".back-btn");
let playBtn = document.querySelector(".play-btn");
let categoryBtn = document.querySelectorAll(".category-btn");
let letterBtn = document.querySelectorAll(".key-btn");
let pauseMenuBtn = document.querySelector(".pause-menu-btn");
let continueGameBtn = document.querySelector(".continue-game-btn");
let newCategoryBtn = document.querySelector(".new-category-btn");
let quitGameBtn = document.querySelector(".quit-game-btn");

// All Pages
let homePage = document.querySelector("#home");
let howToPage = document.querySelector("#instruction");
let categoriesPage = document.querySelector("#category");
let game = document.querySelector("#game");

// Other Variables
let header = document.getElementsByTagName("header")[0];
let headerTitle = document.querySelector(".header-title");
let categoryHeader = document.querySelector(".category-header");
let hiddenWordContainer = document.querySelector(".hidden-word-container");
let healthBar = document.querySelector(".progress-bar");
let pauseMenu = document.querySelector(".pause-menu");
let pauseMenuHeading = document.querySelector(".pause-menu-heading");
let chosenCategory = "";
let hiddenWord = "";
let lettersAlreadyChosen = [];
let animationCount = 0;
let wrongGuesses = 0;
let correctGuesses = 0;
let correctGuess = false;
let health = 100;
let gameOver = false;
let animationInterval;

// buttons behavior
howToBtn.addEventListener("click", () => {
  homePage.classList.add("display");
  header.classList.remove("display");
  header.children[0].classList.remove("display");
  howToPage.classList.remove("display");
  headerTitle.innerText = `How To Play`;
});

backBtn.addEventListener("click", () => {
  homePage.classList.remove("display");
  header.classList.add("display");
  header.children[0].classList.add("display");
  howToPage.classList.add("display");
  categoriesPage.classList.add("display");
});

playBtn.addEventListener("click", () => {
  homePage.classList.add("display");
  header.classList.remove("display");
  header.children[0].classList.remove("display");
  categoriesPage.classList.remove("display");
  headerTitle.innerText = `Pick a Category`;
});

categoryBtn.forEach(function (btn) {
  btn.addEventListener("click", function () {
    chosenCategory = this.value;
    initiateGame(chosenCategory);
    game.classList.remove("display");
    categoriesPage.classList.add("display");
    header.children[0].classList.add("display");
    header.children[1].classList.remove("display");
    categoryHeader.innerHTML = this.value;
  });
});

letterBtn.forEach(function (btn) {
  btn.addEventListener("click", function () {
    if (!this.classList.contains("inactive-key")) {
      this.classList.add("inactive-key");
      this.tabIndex = "-1";
      checkLetter(this.value);
    }
  });
});

pauseMenuBtn.addEventListener("click", function () {
  pauseMenu.classList.remove("display");
});

continueGameBtn.addEventListener("click", function () {
  togglePauseMenu();
  toggleKeyTabIndex();
  if (gameOver) {
    initiateGame(chosenCategory);
  }
});

newCategoryBtn.addEventListener("click", function () {
  toggleKeyTabIndex();
  togglePauseMenu();
  game.classList.add("display");
  categoriesPage.classList.remove("display");
  header.children[0].classList.remove("display");
  header.children[1].classList.add("display");
});

quitGameBtn.addEventListener("click", function () {
  togglePauseMenu();
  toggleKeyTabIndex();
  homePage.classList.remove("display");
  header.children[1].classList.add("display");
  game.classList.add("display");
});

document.addEventListener("keyup", function (event) {
  if (event.repeat) {
    return;
  }
  // console.log(event.key);
  let key = event.key.toLowerCase();
  let buttons = document.querySelectorAll(".key-btn");

  if (!lettersAlreadyChosen.includes(key)) {
    lettersAlreadyChosen.push(key);
    buttons.forEach(function (button) {
      if (button.textContent.trim() === key) {
        checkLetter(key);
        for (let i = 0; i < letterBtn.length; i++) {
          if (event.key === letterBtn[i].value) {
            letterBtn[i].classList.add("inactive-key");
            letterBtn[i].tabIndex = "-1";
          }
        }
      }
    });
  }
});

// All functions
function toggleKeyTabIndex() {
  for (let i = 0; i < letterBtn.length; i++) {
    letterBtn[i].tabIndex = "0";
  }
}

function togglePauseMenu() {
  pauseMenu.classList.toggle("display");
  for (let i = 0; i < letterBtn.length; i++) {
    letterBtn[i].tabIndex = "-1";
  }
}

function initiateGame(category) {
  continueGameBtn.innerHTML = "<h4>Continue</h4>";
  pauseMenuHeading.innerHTML = "Paused";
  hiddenWord = "";
  lettersAlreadyChosen = [];
  animationCount = 0;
  wrongGuesses = 0;
  correctGuesses = 0;
  health = 100;
  correctGuess = false;
  gameOver = false;
  hiddenWordContainer.innerHTML = "";
  healthBar.style.width = health + "%";

  toggleKeyTabIndex();
  for (let i = 0; i < letterBtn.length; i++) {
    letterBtn[i].classList.remove("inactive-key");
  }

  // option 1
  // fetch categories from data object
  const randIndex = Math.floor(
    Math.random() * data.categories[category].length
  );
  hiddenWord = data.categories[category][randIndex].name.toLowerCase();
  // console.log(hiddenWord);
  ChoosenWord(hiddenWord);

  // option 2
  // fetch categories from data.json
  // fetch("../JSON/data.json")
  //   .then((response) => {
  //     if (!response.ok) {
  //       throw new Error("HTTP error " + response.status);
  //     }
  //     return response.json();
  //   })
  //   .then((data) => {
  //     const randIndex = Math.floor(
  //       Math.random() * data.categories[category].length
  //     );
  //     hiddenWord = data.categories[category][randIndex].name.toLowerCase();
  //     // console.log(hiddenWord);
  //     ChoosenWord(hiddenWord);
  //   })
  //   .catch((error) => {
  //     console.error("There was a problem with the fetch operation:", error);
  //   });
}

function ChoosenWord(word) {
  for (let i = 0; i < word.length; i++) {
    const hiddenLetter = document.createElement("div");
    hiddenLetter.classList.add("hidden-letter");
    if (word[i] === " ") {
      hiddenLetter.classList.add("hidden");
      correctGuesses += 1;
    }

    const hiddenLetterInner = document.createElement("div");
    hiddenLetterInner.classList.add("hidden-letter-inner");

    const hiddenLetterFront = document.createElement("div");
    hiddenLetterFront.classList.add("hidden-letter-front");

    const hiddenLetterBack = document.createElement("div");
    hiddenLetterBack.classList.add("hidden-letter-back");

    const h2 = document.createElement("h2");
    h2.textContent = word[i];

    hiddenLetterBack.appendChild(h2);
    hiddenLetterInner.appendChild(hiddenLetterFront);
    hiddenLetterInner.appendChild(hiddenLetterBack);
    hiddenLetter.appendChild(hiddenLetterInner);

    const hiddenWordContainer = document.querySelector(
      ".hidden-word-container"
    );
    hiddenWordContainer.appendChild(hiddenLetter);
  }
}

function checkLetter(letter) {
  for (let i = 0; i < hiddenWord.length; i++) {
    if (letter === hiddenWord[i]) {
      // console.log(letter);
      const letterTile = hiddenWordContainer.children[i].querySelector(
        ".hidden-letter-inner"
      );
      letterTile.classList.add("reveal-letter");
      correctGuess = true;
      correctGuesses += 1;
    }
  }
  if (!correctGuess) {
    health -= 100 / 8;
    wrongGuesses += 1;
  } else {
    correctGuess = false;
  }
  healthBar.style.width = health + "%";

  if (wrongGuesses >= 8) {
    loseGame();
  } else if (correctGuesses == hiddenWord.length && hiddenWord) {
    winGame();
  }
}

function loseGame() {
  for (let i = 0; i < hiddenWord.length; i++) {
    const letter = hiddenWordContainer.children[i].querySelector(
      ".hidden-letter-inner"
    );
    letter.classList.add("reveal-letter");
  }
  continueGameBtn.innerHTML = "<h4>Play Again</h4>";
  pauseMenuHeading.innerHTML = "You Lose";
  gameOver = true;
  setTimeout(togglePauseMenu, 1000);
}

function winGame() {
  gameOver = true;
  continueGameBtn.innerHTML = "<h4>Play Again</h4>";
  pauseMenuHeading.innerHTML = "You Win";
  animationInterval = setInterval(addAnimation, 75);
}
function addAnimation() {
  const hiddenLetter = document.querySelectorAll(".hidden-letter");
  if (animationCount < hiddenLetter.length) {
    hiddenLetter[animationCount].classList.add("animated-letter");
    animationCount += 1;
  } else {
    clearInterval(animationInterval);
    setTimeout(togglePauseMenu, 1000);
  }
}
